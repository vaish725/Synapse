<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Synapse</title>
  <link rel="stylesheet" href="popup.css">
</head>
<body>
  <div class="container">
    <!-- Header -->
    <header class="header">
      <h1 class="logo">
        Synapse
      </h1>
      <div class="status-indicator" id="statusIndicator">
        <span class="status-dot"></span>
        <span class="status-text">Tracking</span>
      </div>
    </header>

    <!-- Current Site Info -->
    <section class="current-site">
      <div class="site-label">Current Site</div>
      <div class="site-domain" id="currentDomain">Loading...</div>
      <div class="site-category" id="siteCategory">
        <select id="categorySelect">
          <option value="neutral">Neutral</option>
          <option value="work">Work</option>
          <option value="unproductive">Unproductive</option>
        </select>
      </div>
    </section>

    <!-- Today's Stats -->
    <section class="stats">
      <h2 class="section-title">Today's Activity</h2>
      <div class="stats-grid">
        <div class="stat-card stat-work">
          <div class="stat-label">Work</div>
          <div class="stat-value" id="workTime">0m</div>
        </div>
        <div class="stat-card stat-unproductive">
          <div class="stat-label">Unproductive</div>
          <div class="stat-value" id="unproductiveTime">0m</div>
        </div>
        <div class="stat-card stat-total">
          <div class="stat-label">Total</div>
          <div class="stat-value" id="totalTime">0m</div>
        </div>
      </div>
    </section>

    <!-- Three Column Grid: Pomodoro + Spotify + AI Insights -->
    <div class="main-grid-three">
      <!-- Left Column: Pomodoro Timer (40%) -->
      <section class="pomodoro">
        <h2 class="section-title">Focus Timer</h2>
        <div class="timer-display" id="timerDisplay">25:00</div>
        <div class="timer-controls">
          <button class="btn btn-primary" id="startBtn">Start</button>
          <button class="btn btn-secondary" id="pauseBtn" disabled>Pause</button>
          <button class="btn btn-secondary" id="resetBtn">Reset</button>
        </div>
        <div class="focus-mode">
          <label class="checkbox-label">
            <input type="checkbox" id="focusModeCheckbox">
            <span>Enable Focus Mode (block unproductive sites)</span>
          </label>
        </div>
      </section>

      <!-- Middle Column: Spotify Player (30%) -->
      <section class="spotify-player">
        <div class="spotify-header">
          <h2 class="section-title">Focus Music</h2>
          <div class="spotify-header-buttons">
            <button class="btn-my-playlists" id="myPlaylistsBtn" style="display: none;">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                <path d="M15 6H3v2h12V6zm0 4H3v2h12v-2zM3 16h8v-2H3v2zM17 6v8.18c-.31-.11-.65-.18-1-.18-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3V8h3V6h-5z"/>
              </svg>
              <span>My Playlists</span>
            </button>
            <button class="btn-spotify-connect" id="spotifyConnectBtn">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 0C5.4 0 0 5.4 0 12s5.4 12 12 12 12-5.4 12-12S18.66 0 12 0zm5.521 17.34c-.24.359-.66.48-1.021.24-2.82-1.74-6.36-2.101-10.561-1.141-.418.122-.779-.179-.899-.539-.12-.421.18-.78.54-.9 4.56-1.021 8.52-.6 11.64 1.32.42.18.479.659.301 1.02zm1.44-3.3c-.301.42-.841.6-1.262.3-3.239-1.98-8.159-2.58-11.939-1.38-.479.12-1.02-.12-1.14-.6-.12-.48.12-1.021.6-1.141C9.6 9.9 15 10.561 18.72 12.84c.361.181.54.78.241 1.2zm.12-3.36C15.24 8.4 8.82 8.16 5.16 9.301c-.6.179-1.2-.181-1.38-.721-.18-.601.18-1.2.72-1.381 4.26-1.26 11.28-1.02 15.721 1.621.539.3.719 1.02.419 1.56-.299.421-1.02.599-1.559.3z"/>
              </svg>
              <span>Connect</span>
            </button>
          </div>
        </div>
        
        <div class="spotify-content" id="spotifyContent">
          <!-- Not Connected State -->
          <div class="spotify-disconnected" id="spotifyDisconnected">
            <div class="spotify-icon">
              <svg width="40" height="40" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 0C5.4 0 0 5.4 0 12s5.4 12 12 12 12-5.4 12-12S18.66 0 12 0zm5.521 17.34c-.24.359-.66.48-1.021.24-2.82-1.74-6.36-2.101-10.561-1.141-.418.122-.779-.179-.899-.539-.12-.421.18-.78.54-.9 4.56-1.021 8.52-.6 11.64 1.32.42.18.479.659.301 1.02zm1.44-3.3c-.301.42-.841.6-1.262.3-3.239-1.98-8.159-2.58-11.939-1.38-.479.12-1.02-.12-1.14-.6-.12-.48.12-1.021.6-1.141C9.6 9.9 15 10.561 18.72 12.84c.361.181.54.78.241 1.2zm.12-3.36C15.24 8.4 8.82 8.16 5.16 9.301c-.6.179-1.2-.181-1.38-.721-.18-.601.18-1.2.72-1.381 4.26-1.26 11.28-1.02 15.721 1.621.539.3.719 1.02.419 1.56-.299.421-1.02.599-1.559.3z"/>
              </svg>
            </div>
            <p class="spotify-message">Connect to play focus music</p>
          </div>

          <!-- Connected State (Hidden by default) -->
          <div class="spotify-connected" id="spotifyConnected" style="display: none;">
            <!-- Embedded Spotify Player -->
            <div class="spotify-embed-container" id="spotifyEmbedContainer">
              <iframe id="spotifyEmbedPlayer" 
                      src="" 
                      width="100%" 
                      height="152" 
                      frameborder="0" 
                      allowtransparency="true" 
                      allow="encrypted-media">
              </iframe>
            </div>

            <div class="spotify-playlists">
              <button class="spotify-playlist-btn" data-playlist="focus">ðŸ“š Focus</button>
              <button class="spotify-playlist-btn" data-playlist="lofi">ðŸŽ§ Lo-Fi</button>
              <button class="spotify-playlist-btn" data-playlist="chill">ðŸŒŠ Chill</button>
            </div>
          </div>
        </div>
      </section>

      <!-- Right Column: AI Insights (30%) -->
      <section class="insights">
        <div class="insights-header">
          <h2 class="section-title">AI Insights</h2>
          <button class="btn-ai" id="generateInsightsBtn">Generate</button>
        </div>
        <div class="insights-content" id="insightsContent">
          <p class="insights-placeholder">Click "Generate" to get personalized insights based on your activity.</p>
        </div>
      </section>
    </div>

    <!-- Footer -->
    <footer class="footer">
      <button class="btn btn-footer" id="openInTabBtn">Open in New Tab</button>
      <button class="btn btn-footer" id="settingsBtn">Settings</button>
      <button class="btn btn-footer" id="viewDataBtn">View Data</button>
    </footer>
  </div>

  <!-- Playlist Picker Modal -->
  <div class="playlist-picker-overlay" id="playlistPickerOverlay" style="display: none;">
    <div class="playlist-picker-modal">
      <div class="playlist-picker-header">
        <h3 id="playlistPickerTitle">Choose a Playlist</h3>
        <button class="playlist-picker-close" id="playlistPickerClose">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
            <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
          </svg>
        </button>
      </div>
      <div class="playlist-picker-tabs">
        <button class="playlist-tab active" data-tab="genre">Genre Playlists</button>
        <button class="playlist-tab" data-tab="user">My Playlists</button>
      </div>
      <div class="playlist-picker-content">
        <div class="playlist-picker-loading" id="playlistLoading">
          <div class="loading-spinner"></div>
          <p>Loading playlists...</p>
        </div>
        <div class="playlist-picker-grid" id="playlistGrid"></div>
      </div>
    </div>
  </div>

  <script src="../src/spotify/spotify-integration.js"></script>
  <script src="../src/spotify/spotify-ui.js"></script>
  <script src="../src/ai/ai-insights-multi.js"></script>
  <script src="popup.js"></script>
</body>
</html>
